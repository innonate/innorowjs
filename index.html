<!doctype html>
<html>
  <head>
    <title>innorow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <style>
      .label {
        font-size: 50px
      }
      .rowingData {
        font-size: 100px
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col-xs-12">
          <span id="rpm"></span><span id="acceleration">&nbsp;</span>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-6">
          <form id='stopWatchForm'>
            <button class="btn btn-lg btn-success"><span id="stopWatchButton">Start</span></button>
          </form>
        </div>
        <div class="col-xs-6">
          <form id='saveDataForm'>
            <button class="btn btn-lg btn-info"><span id="saveDataButton">Save Data</span></button>
          </form>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-xs-6">
          <h1><span class='rowingData' id="timeElapsed">00:00</span><br/><small>Time</small></h1>
        </div>
        <div class="col-xs-6" id="heartRateZone">
          <h1><span class='rowingData' id="heartRate">--</span><br/><small><span id="heartRateLabel">HR</span></small></h1>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-xs-6">
          <h1><span class='rowingData' id="distance">0</span><small>M</small><br/><small>Distance</small></h1>
        </div>
        <div class="col-xs-6">
          <h1><span class='rowingData' id="strokeRate">0</span><small>spm</small><br/><small>Stroke Rate</small></h1>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-xs-6">
          <h1><span class='rowingData' id="calories">0</span><br/><small>Calories</small></h1>
        </div>
        <div class="col-xs-6">
          <h1><span class='rowingData' id="fiveHundredSplit">0</span><br/><small>500m split</small></h1>
        </div>
      </div>
      <hr>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script>
      var socket = io();
      socket.on('rpm', function(msg){
        $('#rpm').text(msg);
      });
      socket.on('five hundred split', function(msg){
        $('#fiveHundredSplit').text(msg);
      });
      socket.on('distance', function(msg){
        $('#distance').text(msg);
      });
      socket.on('acceleration', function(msg){
        if (msg == 'DECELERATING'){
          $('#acceleration').html('&nbsp;');  
        } else {
          $('#acceleration').text(' - '+ msg);  
        }
        
      });
      socket.on('stroke rate', function(msg){
        $('#strokeRate').text(msg);
      });
      socket.on('stopwatch time', function(msg){
        $('#timeElapsed').text(msg);
        $('#stopWatchButton').text('Stop');
      });
      socket.on('heart rate payload', function(msg){
        $('#heartRateLabel').text(msg.label);
        $('#heartRate').text(msg.hr);
        if ((msg.heatrate_zone == 'WARMUP') || (msg.heatrate_zone == undefined)) {
          bgColor = 'white'
        } else if (msg.heatrate_zone == 'FAT_BURNING') {
          bgColor = '#5cb85c'
        } else if (msg.heatrate_zone == 'THRESHOLD') {
          bgColor = '#f0ad4e'
        } else if (msg.heatrate_zone == 'ANAEROBIC') {
          bgColor = '#d9534f'
        } else {
          bgColor = 'purple'
        }
        $('#heartRateZone').css("background-color", bgColor);
      });
      socket.on('calories', function(msg){
        $('#calories').text(msg);
      });
      socket.on('stopwatch button value', function(msg){
        if (msg == 'Stop') {
          $('#stopWatchForm').find('button').addClass('btn-danger').removeClass('btn-success');
        } else if (msg == 'Clear Data'){
          $('#stopWatchForm').find('button').addClass('btn-warning').removeClass('btn-danger');
        } else {
          $('#stopWatchForm').find('button').addClass('btn-success').removeClass('btn-warning');
        }
        $('#stopWatchButton').text(msg);
      });
      $('#stopWatchForm').submit(function(){
        buttonText = $('#stopWatchForm').find('button')[0].innerText
        if (buttonText == 'Start'){
          sendValue = 'START';
        } else if (buttonText == 'Clear Data'){
          sendValue = 'CLEAR';
        } else {
          sendValue = 'PAUSE';
        }
        socket.emit('start timer', sendValue);
          return false;
      });
      $('#saveDataForm').submit(function(){
        socket.emit('save data', true);
        return false;
      });
      if (navigator.wakeLock != undefined){
        navigator.wakeLock.request("display").then(
          function successFunction() {
            // success
            console.log('Keeping Display Awake');
          },
          function errorFunction() {
            // error
        });
      }
      //release() is used to release the lock.
      // navigator.wakeLock.release("display");
    </script>
  </body>
</html>